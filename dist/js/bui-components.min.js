!function(c){function n(o){for(var a=o.target;a;){if("bui_combobox_popover"==a.className||"bui_combobox_node"==a.className)return;a=a.parentNode}c(".bui_combobox_popover").remove(),c(document).unbind("click",n)}function r(e,o){var a,i=[],o=(function e(o,i){o instanceof Array&&0<o.length&&c.each(o,function(o,a){a.children instanceof Array&&0<a.children.length&&e(a.children,i),i.push({name:a.name,value:a.value})})}(o,a=[]),a);return c.each(o,function(o,a){-1!==c.inArray(a.value,e)&&i.unshift(a)}),i}function a(o,a,e){var i,n,i=(i=a,a=(n=e).placeholder,(i=r(i,n.options))instanceof Array&&0<i.length?'<span class="bui_combobox_value">'+(a="boolean"==typeof n.multiselect&&n.multiselect?c.map(i,function(o){return'<span class="bui_combobox_tag" data_value="'+o.value+'">'+o.name+'<span class="glyphicon glyphicon-remove bui_combobox_tag_remove"></span></span>'}).join(""):i[0].name)+"</span>":'<span class="bui_combobox_placeholder">'+a+"</span>");if("input"!==o[0].localName)return o.attr("data_value",""),o.addClass("bui_combobox"),o.append(i+'<input value="'+e.value.join(",")+'" name="'+e.name+'" disabled="'+e.disabled+'" style="display: none;" />'),o;a=o.attr("class");return o.wrap('<div class="bui_combobox"></div>'),o.parent().addClass(a),c(i).insertBefore(o),o.hide(),o.attr("class",""),o.attr("value",e.value),o.attr("name",e.name),o.attr("disabled",e.disabled),o.parent()}function e(o,a,e){c(".bui_combobox_popover").remove();var o={top:(i=o).offset().top,left:i.offset().left,width:i.outerWidth(),height:i.outerHeight(),winWidth:c(window).width(),winHeight:c(window).height()},i=(o.winWidth/2<o.left?"right: "+(o.winWidth-o.left-o.width)+"px; ":"left: "+o.left+"px; ")+(o.winHeight/2<o.top?"bottom: "+(o.winHeight-o.top)+"px; ":"top: "+(o.top+o.height)+"px; "),a=function i(o,n){var t="";return o instanceof Array&&0<o.length&&c.each(o,function(o,a){var e=-1!==c.inArray(a.value,n)?"active":"";a.children instanceof Array&&0<a.children.length?t+='<li class="bui_combobox_item" data_value="'+a.value+'" data_name="'+a.name+'"><div class="bui_combobox_node '+e+'"><span class="bui_combobox_switch"><span class="glyphicon glyphicon-triangle-bottom"></span></span>'+a.name+'</div><ul class="bui_combobox_ul">'+i(a.children,n)+"</ul></li>":t+='<li class="bui_combobox_item" data_value="'+a.value+'" data_name="'+a.name+'"><div class="bui_combobox_node '+e+'"><span class="bui_combobox_empty"></span>'+a.name+"</div></li>"}),t}(e.options,a);return c("body").append('<div class="bui_combobox_popover" style="'+i+"width: "+o.width+'px;" >'+a+"</div>"),c(document).bind("click",n),c(".bui_combobox_popover")}c.fn.combobox=function(o){var t=c(this),l=c.extend({options:[],value:[],name:"",placeholder:"请选择",multiselect:!1,disabled:!1,format:null,onChange:null},o),s=l.value;if((t=a(t,s,l)).attr("disabled")||l.disabled)return t.find("input").attr("disabled",!0),void t.addClass("disabled");t.on("click",".bui_combobox_tag_remove",function(o){o.stopPropagation();var a=c(this).parent(".bui_combobox_tag"),e=a.attr("data_value"),i=c.inArray(e,s),n=t.find(".bui_combobox_value"),o=t.find("input");c(".bui_combobox_popover").find("[data_value="+e+"]").find(".bui_combobox_node").eq(0).removeClass("active"),s.splice(i,1),a.remove(),0===s.length&&(n.addClass("placeholder"),n.text(l.placeholder)),o.attr("value",s.join(",")),l.onChange instanceof Function&&l.onChange(r(s,l.options))}),t.on("click",function(o){o.stopPropagation();var a=c(this).find("input").val().split(","),o=e(t,a,l);l.onChange instanceof Function&&l.onChange(r(a,l.options)),o.on("click",".bui_combobox_switch",function(o){o.stopPropagation(),c(this).toggleClass("curr"),c(this).parent().siblings("ul").slideToggle(),c(this).hasClass("curr")?c(this).find(".glyphicon").attr("class","glyphicon glyphicon-triangle-right"):c(this).find(".glyphicon").attr("class","glyphicon glyphicon-triangle-bottom")}),o.on("click",".bui_combobox_item",function(o){o.stopPropagation();var a,e=c(this).attr("data_value"),i=c(this).attr("data_name"),n=t.find(".bui_combobox_value"),o=t.find("input");"boolean"==typeof l.multiselect&&l.multiselect?-1===(a=c.inArray(e,s))?(0===s.length&&(n.removeClass("placeholder"),n.html("")),s.push(e),n.append('<span class="bui_combobox_tag" data_value="'+e+'">'+i+'<span class="glyphicon glyphicon-remove bui_combobox_tag_remove"></span></span>'),c(this).find(".bui_combobox_node").eq(0).addClass("active")):(s.splice(a,1),n.find(".bui_combobox_tag").eq(a).remove(),0===s.length&&(n.addClass("placeholder"),n.text(l.placeholder)),c(this).find(".bui_combobox_node").eq(0).removeClass("active")):(-1===(a=c.inArray(e,s))?(s=[e],n.removeClass("placeholder"),n.text(i)):(s.splice(a,1),n.addClass("placeholder"),n.text(l.placeholder)),c(this).find(".bui_combobox_node").eq(0).addClass("active"),c(this).siblings().find(".bui_combobox_node").eq(0).removeClass("active")),o.attr("value",s.join(",")),l.onChange instanceof Function&&l.onChange(r(s,l.options))})})}}(jQuery);