!function(l){function s(o){for(var i=o.target;i;){if("bui_combobox"==i.className||"combobox_node"==i.className)return;i=i.parentNode}l(".bui_combobox").remove(),l(document).unbind("click",s)}l.fn.combobox=function(o){var a=l(this),e=l.extend({options:[],initValue:[],name:"",multiselect:!1,disabled:!1,format:null,onChange:null},o),n=e.initValue;"input"!==a[0].localName?(n&&a.attr("data_value",n.join(",")),a.append('<span></span><input value="'+n.join(",")+'" style="display: none;" disabled="'+e.disabled+'" name="'+e.name+'" />'),e.format instanceof Function&&a.find("span").html(e.format(n))):(a.attr("name")||a.attr("name",e.name),n&&a.attr("value",n.join(","))),a.attr("disabled")||e.disabled?e.disabled&&a.attr("disabled",e.disabled):a.on("click",function(o){o.stopPropagation(),l(".bui_combobox").remove();var i={top:(t=a).offset().top,left:t.offset().left,width:t.outerWidth(),height:t.outerHeight(),winWidth:l(window).width(),winHeight:l(window).height()},o=(i.winWidth/2<i.left?"right:"+(i.winWidth-i.left-i.width)+"px":"left:"+i.left+"px;")+(i.winHeight/2<i.top?"bottom:"+(i.winHeight-i.top)+"px":"top:"+(i.top+i.height)+"px;"),t=function t(o){var a="";return o instanceof Array&&0<o.length&&l.each(o,function(o,i){i.children instanceof Array&&0<i.children.length?a+='<li class="bui_combobox_item" data_value="'+i.value+'" data_name="'+i.name+'"><div class="bui_combobox_node"><span class="bui_combobox_switch"><span class="glyphicon glyphicon-triangle-right"></span></span>'+i.name+'</div><ul class="bui_combobox_ul">'+t(i.children)+"</ul></li>":a+='<li class="bui_combobox_item" data_value="'+i.value+'" data_name="'+i.name+'"><div class="bui_combobox_node"><span class="bui_combobox_empty"></span>'+i.name+"</div></li>"}),a}(e.options);l("body").append('<div class="bui_combobox" style="'+o+"width:"+i.width+'px;" >'+t+"</div>"),l(document).bind("click",s),l(".bui_combobox").on("click",".bui_combobox_switch",function(o){o.stopPropagation(),l(this).toggleClass("curr"),l(this).parent().siblings("ul").slideToggle()}),l(".bui_combobox").on("click",".bui_combobox_item",function(o){o.stopPropagation();var i=l(this).attr("data_value"),o=l(this).attr("data_name");console.log(i,o),"boolean"==typeof e.multiselect&&e.multiselect?-1===(o=l.inArray(i,n))?(n.push(i),l(this).find(".bui_combobox_node").eq(0).addClass("active")):(n.splice(o,1),l(this).find(".bui_combobox_node").eq(0).removeClass("active")):(n=[i],l(this).find(".bui_combobox_node").eq(0).addClass("active"),l(this).siblings().find(".bui_combobox_node").eq(0).removeClass("active")),e.format instanceof Function&&a.find("span").html(e.format(n))})})}}(jQuery);