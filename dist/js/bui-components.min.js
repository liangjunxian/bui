!function(s){function t(o){for(var e=o.target;e;){if("bui_combobox_popover"==e.className||"bui_combobox_node"==e.className)return;e=e.parentNode}s(".bui_combobox_popover").remove(),s(document).unbind("click",t)}function n(a,o){var e,i=[],o=(function a(o,i){o instanceof Array&&0<o.length&&s.each(o,function(o,e){e.children instanceof Array&&0<e.children.length&&a(e.children,i),i.push({name:e.name,value:e.value})})}(o,e=[]),e);return s.each(o,function(o,e){-1!==s.inArray(e.value,a)&&i.unshift(e)}),i}function e(o,e,a){var i,t,i=(i=e,e=(t=a).placeholder,(i=n(i,t.options))instanceof Array&&0<i.length?'<span class="bui_combobox_value">'+(e="boolean"==typeof t.multiselect&&t.multiselect?s.map(i,function(o){return'<span class="bui_combobox_tag">'+o.name+"</span>"}).join(""):i[0].name)+"</span>":'<span class="bui_combobox_placeholder">'+e+"</span>");if("input"!==o[0].localName)return o.attr("data_value",""),o.addClass("bui_combobox"),o.append(i+'<input value="'+a.value.join(",")+'" name="'+a.name+'" disabled="'+a.disabled+'" style="display: none;" />'),o;e=o.attr("class");return o.wrap('<div class="bui_combobox"></div>'),o.parent().addClass(e),s(i).insertBefore(o),o.hide(),o.attr("class",""),o.attr("value",a.value),o.attr("name",a.name),o.attr("disabled",a.disabled),o.parent()}function a(o,e,a){s(".bui_combobox_popover").remove();var o={top:(i=o).offset().top,left:i.offset().left,width:i.outerWidth(),height:i.outerHeight(),winWidth:s(window).width(),winHeight:s(window).height()},i=(o.winWidth/2<o.left?"right: "+(o.winWidth-o.left-o.width)+"px; ":"left: "+o.left+"px; ")+(o.winHeight/2<o.top?"bottom: "+(o.winHeight-o.top)+"px; ":"top: "+(o.top+o.height)+"px; "),e=function i(o,t){var n="";return o instanceof Array&&0<o.length&&s.each(o,function(o,e){var a=-1!==s.inArray(e.value,t)?"active":"";e.children instanceof Array&&0<e.children.length?n+='<li class="bui_combobox_item" data_value="'+e.value+'" data_name="'+e.name+'"><div class="bui_combobox_node '+a+'"><span class="bui_combobox_switch"><span class="glyphicon glyphicon-triangle-bottom"></span></span>'+e.name+'</div><ul class="bui_combobox_ul">'+i(e.children)+"</ul></li>":n+='<li class="bui_combobox_item" data_value="'+e.value+'" data_name="'+e.name+'"><div class="bui_combobox_node '+a+'"><span class="bui_combobox_empty"></span>'+e.name+"</div></li>"}),n}(a.options,e);return s("body").append('<div class="bui_combobox_popover" style="'+i+"width: "+o.width+'px;" >'+e+"</div>"),s(document).bind("click",t),s(".bui_combobox_popover")}s.fn.combobox=function(o){var t=s(this),n=s.extend({options:[],value:[],name:"",placeholder:"请选择",multiselect:!1,disabled:!1,format:null,onChange:null},o),l=n.value;(t=e(t,l,n)).attr("disabled")||n.disabled?t.find("input").attr("disabled",!0):t.on("click",function(o){o.stopPropagation();o=a(t,l,n);o.on("click",".bui_combobox_switch",function(o){o.stopPropagation(),s(this).toggleClass("curr"),s(this).parent().siblings("ul").slideToggle(),s(this).hasClass("curr")?s(this).find(".glyphicon").attr("class","glyphicon glyphicon-triangle-right"):s(this).find(".glyphicon").attr("class","glyphicon glyphicon-triangle-bottom")}),o.on("click",".bui_combobox_item",function(o){o.stopPropagation();var e,a=s(this).attr("data_value"),i=s(this).attr("data_name"),o=t.find(".bui_combobox_value");"boolean"==typeof n.multiselect&&n.multiselect?-1===(e=s.inArray(a,l))?(0===l.length&&o.removeClass("placeholder"),l.push(a),o.append('<span class="bui_combobox_tag">'+i+"</span>"),s(this).find(".bui_combobox_node").eq(0).addClass("active")):(l.splice(e,1),o.find(".bui_combobox_tag").eq(e).remove(),0===l.length&&(o.addClass("placeholder"),o.text(n.placeholder)),s(this).find(".bui_combobox_node").eq(0).removeClass("active")):(-1===(e=s.inArray(a,l))?(l=[a],o.removeClass("placeholder"),o.text(i)):(l.splice(e,1),o.addClass("placeholder"),o.text(n.placeholder)),s(this).find(".bui_combobox_node").eq(0).addClass("active"),s(this).siblings().find(".bui_combobox_node").eq(0).removeClass("active"))})})}}(jQuery);